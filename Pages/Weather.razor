@page "/weather"

<PageTitle>Brano del Giorno</PageTitle>

<h1>🎧 Brano del giorno</h1>

<p>Clicca il pulsante e ascolta un brano Spotify a caso!</p>

<button class="btn btn-success" @onclick="ShowTrack">🎵 Ascolta</button>

@if (!string.IsNullOrEmpty(selectedTrackId))
{
    <div class="mt-3">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <iframe 
                    data-testid="embed-iframe" 
                    style="border-radius:12px; width: 100%; height: 352px;" 
                    src="https://open.spotify.com/embed/@(selectedTrackType)/@selectedTrackId?utm_source=generator" 
                    frameBorder="0" 
                    allowfullscreen="" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                    loading="lazy">
                </iframe>
            </div>
        </div>
        <div class="mt-3 text-center">
            <a href="https://open.spotify.com/@(selectedTrackType)/@selectedTrackId" 
               target="_blank" 
               class="btn btn-success">
                🎧 Ascolta su Spotify
            </a>
            <button class="btn btn-outline-primary ms-2" @onclick="ShowTrack">
                🔄 Cambia brano
            </button>
        </div>
    </div>
}

@code {
    private TrackInfo[] tracks = new[]
    {
        new TrackInfo("1JLqV47zQDS0uK4HYGgbcy", "track", "Track: Resti - YangKidd, L0z"),
        new TrackInfo("1ENVbao2JW8qU3mmBNUf6v", "track", "Track: DatKid - Opposition Freestyle"),
        new TrackInfo("7tXS3GFgQg880jnVgjV6l9", "track", "Track: Bello FiGO - DO YOU RINGO"),
        new TrackInfo("32LlcNsYqf7QUg5eBup5Cs", "track", "Track: RONDO X AL PACINO"),
        new TrackInfo("2u3bdHZOy5eY1pTQLCUXGR", "track", "Track: Faneto - Modelle & Delinquenti "),
        new TrackInfo("7CnJ1gvjXZuRWfvv33ZeVY", "track", "Track: CASE - Sadturs, KIID, Flaco G, Lubi")
    };

    private string? selectedTrackId;
    private string? selectedTrackType;

    private void ShowTrack()
    {
        var random = new Random();
        var track = tracks[random.Next(tracks.Length)];
        selectedTrackId = track.Id;
        selectedTrackType = track.Type;
    }

    private record TrackInfo(string Id, string Type, string Description);
}