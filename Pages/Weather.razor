@page "/weather"

<PageTitle>Brano del Giorno</PageTitle>

<h1>🎧 Brano del giorno</h1>

<p>Clicca il pulsante e ascolta un brano Spotify a caso!</p>

<button class="btn btn-success" @onclick="ShowTrack">🎵 Ascolta</button>

@if (!string.IsNullOrEmpty(selectedTrackId))
{
    <div class="mt-3">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <iframe 
                    data-testid="embed-iframe" 
                    style="border-radius:12px; width: 100%; height: 352px;" 
                    src="https://open.spotify.com/embed/@(selectedTrackType)/@selectedTrackId?utm_source=generator" 
                    frameBorder="0" 
                    allowfullscreen="" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                    loading="lazy">
                </iframe>
            </div>
        </div>
        <div class="mt-3 text-center">
            <a href="https://open.spotify.com/@(selectedTrackType)/@selectedTrackId" 
               target="_blank" 
               class="btn btn-success">
                🎧 Ascolta su Spotify
            </a>
            <button class="btn btn-outline-primary ms-2" @onclick="ShowTrack">
                🔄 Cambia brano
            </button>
        </div>
    </div>
}

@code {
    private TrackInfo[] tracks = new[]
    {
        new TrackInfo("1SdiNqJzrQ6elJ8HbHoijJ", "album", "Album: The Weeknd"),
        new TrackInfo("1ENVbao2JW8qU3mmBNUf6v", "track", "Track: Good 4 U - Olivia Rodrigo"),
        new TrackInfo("7tXS3GFgQg880jnVgjV6l9", "track", "Track: Stay - The Kid LAROI"),
        new TrackInfo("4iV5W9uYEdYUVa79Axb7Rh", "track", "Track: New Rules - Dua Lipa"),
        new TrackInfo("0VjIjW4GlULA4LGNGrGvdw", "track", "Track: Blinding Lights - The Weeknd")
    };

    private string? selectedTrackId;
    private string? selectedTrackType;

    private void ShowTrack()
    {
        var random = new Random();
        var track = tracks[random.Next(tracks.Length)];
        selectedTrackId = track.Id;
        selectedTrackType = track.Type;
    }

    private record TrackInfo(string Id, string Type, string Description);
}